var Game=pc.createScript("game");Game.attributes.add("uiMenu",{type:"entity"}),Game.attributes.add("uiInGame",{type:"entity"}),Game.attributes.add("uiGameOver",{type:"entity"}),Game.attributes.add("audio",{type:"entity"}),Game.attributes.add("gameRoot",{type:"entity"}),Game.STATE_MENU="menu",Game.STATE_INGAME="ingame",Game.STATE_GAMEOVER="gameover",Game.attributes.add("highScoreText",{type:"entity"}),Game.prototype.initialize=function(){this._state=Game.STATE_MENU,this._score=0,this.app.on("external:highScoreSet",this.setHighScoreUI,this),this.app.on("external:stopgame",this.killTheGame,this),this.setResolution(),window.addEventListener("resize",this.setResolution.bind(this)),this.app.on("ui:start",this.start,this),this.app.on("ui:reset",this.reset,this),this.app.fire("game:init")},Game.prototype.killTheGame=function(){console.log("Kill the Game"),this.gameRoot.enabled=!1},Game.prototype.setResolution=function(){var e=window.screen.width,t=window.screen.height;e<640&&(this.app.setCanvasResolution(pc.RESOLUTION_AUTO,e,t),this.app.setCanvasFillMode(pc.FILLMODE_FILL_WINDOW))},Game.prototype.setHighScoreUI=function(e){let t="High Score: "+e.toString();this.highScoreText.element.text=t,console.log("in Game: "+t)},Game.prototype.start=function(){this._state=Game.STATE_INGAME,this.app.fire("game:start"),this.uiMenu.enabled=!1,this.uiInGame.enabled=!0,this.audio.sound.play("music")},Game.prototype.gameOver=function(){this._state=Game.STATE_GAMEOVER,this.app.fire("game:gameover"),this.uiInGame.enabled=!1,this.uiGameOver.enabled=!0,this.app.fire("game:score",this._score),this.audio.sound.stop(),this.audio.sound.play("gameover")},Game.prototype.reset=function(){this.app.fire("game:reset"),this.resetScore(),this._state=Game.STATE_MENU,this.uiGameOver.enabled=!1,this.uiMenu.enabled=!0,this.audio.sound.stop()},Game.prototype.getScore=function(){return this._score},Game.prototype.addScore=function(e){this._score+=e,this.app.fire("game:score",this._score)},Game.prototype.resetScore=function(){this._score=0,this.app.fire("game:score",this._score)};var UiScore=pc.createScript("uiScore");UiScore.prototype.initialize=function(){this.score=this.entity.findByName("Score"),this.on("enable",this.onEnable,this),this.on("disable",this.onDisable,this),this.onEnable()},UiScore.prototype.onEnable=function(){this.app.on("game:score",this._changeScore,this),this._changeScore(0)},UiScore.prototype.onDisable=function(){this.app.off("game:score",this._changeScore,this)},UiScore.prototype._changeScore=function(e){this.score.element.text=e.toString()};var UiGameover=pc.createScript("uiGameover");UiGameover.attributes.add("overlay",{type:"entity"}),UiGameover.prototype.initialize=function(){this.score=this.entity.findByName("Score"),this._score=0,this.app.on("game:score",(function(e){this._score=e,this.score.element.text=this._score.toString()}),this),this.onEnable(),this.on("enable",this.onEnable,this),this.on("disable",this.onDisable,this)},UiGameover.prototype.onEnable=function(){this.overlay.enabled=!0,this.overlay.element.on("click",this.reset,this)},UiGameover.prototype.onDisable=function(){this.overlay.enabled=!1,this.overlay.element.off("click",this.reset,this)},UiGameover.prototype.reset=function(e){this.app.fire("ui:reset"),e.stopPropagation()};var UiMenu=pc.createScript("uiMenu");UiMenu.attributes.add("overlay",{type:"entity"}),UiMenu.attributes.add("leaderboardButton",{type:"entity"}),UiMenu.attributes.add("leaderboardMenu",{type:"entity"}),UiMenu.attributes.add("leaderboardBackButton",{type:"entity"}),UiMenu.attributes.add("showAdButton",{type:"entity"}),UiMenu.attributes.add("payWithStarButton",{type:"entity"}),UiMenu.attributes.add("shareWithFriendButton",{type:"entity"}),UiMenu.attributes.add("connectWalletButton",{type:"entity"}),UiMenu.attributes.add("payTonButton",{type:"entity"}),UiMenu.attributes.add("disconnectWalletButton",{type:"entity"}),UiMenu.prototype.initialize=function(){this.on("enable",this.onEnable,this),this.on("disable",this.onDisable,this),this.onEnable(),this.leaderboardButton.button.on("click",(function(t){this.leaderboardMenu.enabled=!0,this.app.fire("game:showleaderboard")}),this),this.showAdButton.button.on("click",(function(t){this.app.fire("game:showad")}),this),this.payWithStarButton.button.on("click",(function(t){this.app.fire("game:paywithstar")}),this),this.connectWalletButton.button.on("click",(function(t){this.app.fire("game:connectWallet")}),this),this.payTonButton.button.on("click",(function(t){this.app.fire("game:payTon",.1)}),this),this.disconnectWalletButton.button.on("click",(function(t){this.app.fire("game:disconnectWallet")}),this),this.shareWithFriendButton.button.on("click",(function(t){this.app.fire("game:sharewithfriend")}),this),this.leaderboardBackButton.button.on("click",(function(t){this.leaderboardMenu.enabled=!1}),this)},UiMenu.prototype.onEnable=function(){this.overlay.enabled=!0,this.overlay.element.on("click",this.start,this),this.ball&&(this.ball.model.meshInstances[0].material.depthTest=!1)},UiMenu.prototype.onDisable=function(){this.overlay.enabled=!1,this.overlay.element.off("click",this.start,this)},UiMenu.prototype.start=function(t){this.app.fire("ui:start"),t.stopPropagation()};var Input=pc.createScript("input");Input.attributes.add("ball",{type:"entity"}),Input.attributes.add("camera",{type:"entity"}),Input.attributes.add("ballRadius",{type:"number",default:.5}),Input.worldPos=new pc.Vec3,Input.prototype.initialize=function(){var t=this;this._paused=!0,this.app.on("game:start",(function(){t._paused=!1})),this.app.on("game:gameover",(function(){t._paused=!0})),this.app.touch&&this.app.touch.on("touchstart",this._onTouchStart,this),this.app.mouse.on("mousedown",this._onMouseDown,this)},Input.prototype._onTap=function(t,a){var o=this.ball.getPosition(),n=this.camera.getPosition(),e=Input.worldPos;this.camera.camera.screenToWorld(t,a,n.z-o.z,e);var i=o.x-e.x,p=o.y-e.y;i*i+p*p<this.ballRadius*this.ballRadius&&this.ball.script.ball.tap(i,p)},Input.prototype._onTouchStart=function(t){if(!this._paused){var a=t.changedTouches[0];this._onTap(a.x,a.y),t.event.preventDefault()}},Input.prototype._onMouseDown=function(t){this._paused||this._onTap(t.x,t.y)};var Ball=pc.createScript("ball");Ball.attributes.add("gravity",{type:"number",default:-9.8,description:"The value of gravity to use"}),Ball.attributes.add("defaultTap",{type:"number",default:5,description:"Speed to set the ball to when it is tapped"}),Ball.attributes.add("impactEffect",{type:"entity",description:"The particle effect to trigger when the ball is tapped"}),Ball.attributes.add("ballMinimum",{type:"number",default:-6,description:"When ball goes below minimum y value game over is triggered"}),Ball.attributes.add("speedMult",{type:"number",default:4,description:"Multiplier to apply to X speed when tap is off center"}),Ball.attributes.add("angMult",{type:"number",default:-6,description:"Multiplier to apply to angular speed when tap is off center"}),Ball.tmp=new pc.Vec3,Ball.prototype.initialize=function(){this.paused=!0,this.game=this.app.root.findByName("Game"),this.app.on("game:start",this.unpause,this),this.app.on("game:gameover",this.pause,this),this.app.on("game:reset",this.reset,this),this._vel=new pc.Vec3(0,0,0),this._acc=new pc.Vec3(0,this.gravity,0),this._angSpeed=0,this._origin=this.entity.getLocalPosition().clone(),this._rotation=this.entity.getLocalRotation().clone()},Ball.prototype.update=function(t){if(this.paused)this.entity.rotate(0,30*t,0);else{var e=this.entity.getLocalPosition(),i=Ball.tmp;i.copy(this._acc).scale(t),this._vel.add(i),i.copy(this._vel).scale(t),e.add(i),this.entity.setLocalPosition(e),this.entity.rotate(0,0,this._angSpeed),e.y<this.ballMinimum&&this.game.script.game.gameOver()}},Ball.prototype.tap=function(t,e,i){this._vel.set(this.speedMult*t,this.defaultTap,0),this._angSpeed+=this.angMult*t;var a=Ball.tmp;a.copy(this.entity.getLocalPosition()),a.x-=t,a.y-=e,this.impactEffect.setLocalPosition(a),this.impactEffect.particlesystem.reset(),this.impactEffect.particlesystem.play(),this.impactEffect.lookAt(this.entity.getPosition()),this.entity.sound.play("bounce"),i||this.game.script.game.addScore(1)},Ball.prototype.unpause=function(){this.paused=!1,this.tap(0,0,!0)},Ball.prototype.pause=function(){this.paused=!0},Ball.prototype.reset=function(){this.entity.setLocalPosition(this._origin),this.entity.setLocalRotation(this._rotation),this._vel.set(0,0,0),this._acc.set(0,this.gravity,0),this._angSpeed=0};pc.script.createLoadingScreen((function(e){var t,o,setProgress=function(e){var t=document.getElementById("top-half"),o=document.getElementById("bottom-half"),a=document.getElementById("mask");if(t&&o&&a){var r=180*(e=Math.min(1,Math.max(0,e)));t.style.backgroundColor=0===e?"#00d0ff":"#6565d1",o.style.backgroundColor=0===e?"#00d0ff":"#8686ff",r<=180?(t.style.transform="rotate("+r+"deg)",o.style.transform="rotate(0deg)",a.style.opacity=0):(t.style.transform="rotate(180deg)",o.style.transform="rotate("+(r-180)+"deg)",a.style.opacity=1)}};t=["body {","    background-color: #283538;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #283538;","}","","#application-splash {","    position: absolute;","    top: calc(50% - 64px);","    left: calc(50% - 64px);","    text-align: center;","}","","#progress-bar-container {","    position: relative;","    width: 128px;","    height: 128px;","}","","#progress-circle {","    width: 100%;","    height: 100%;","    position: relative;","    border-radius: 50%;","}","","#top-half, #bottom-half {","    width: 100%;","    height: 100%;","    position: absolute;","    clip: rect(0, 128px, 64px, 0);","    border-radius: 50%;","    background-color: #283538;","}","","#top-half {","    transform: rotate(0deg);","    transform-origin: 64px 64px;","}","","#bottom-half {","    transform: rotate(0deg);","    transform-origin: 64px 64px;","}","","#mask {","    position: absolute;","    top: 0;","    left: 0;","    width: 100%;","    height: 100%;","    border-radius: 50%;","    background-color: #283538;","    clip: rect(64px, 128px, 128px, 0);","    opacity: 0;","}","","@media (max-width: 480px) {","    #application-splash {","        top: calc(50% - 42px);","        left: calc(50% - 42px);","    }","    #progress-bar-container {","        width: 84px;","        height: 84px;","    }","    #top-half, #bottom-half {","        clip: rect(0, 84px, 42px, 0);","    }","    #mask {","        clip: rect(42px, 84px, 84px, 0);","    }","}"].join("\n"),(o=document.createElement("style")).type="text/css",o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t)),document.head.appendChild(o),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var t=document.createElement("div");t.id="application-splash",e.appendChild(t),t.style.display="none",t.style.display="block";var o=document.createElement("div");o.id="progress-bar-container",t.appendChild(o);var a=document.createElement("div");a.id="progress-circle",o.appendChild(a);var r=document.createElement("div");r.id="top-half",a.appendChild(r);var p=document.createElement("div");p.id="bottom-half",a.appendChild(p);var i=document.createElement("div");i.id="mask",a.appendChild(i)}(),e.on("preload:end",(function(){var t;e.off("preload:progress",setProgress),(t=document.getElementById("application-splash-wrapper"))&&t.parentElement.removeChild(t)})),e.on("preload:progress",setProgress)}));var Leaderboard=pc.createScript("leaderboard");Leaderboard.attributes.add("scrollControllerEntity",{type:"entity"});let players=[];Leaderboard.prototype.initialize=function(){this.players=[],this.app.on("external:leaderboardSet",this.setLeaderboard,this)},Leaderboard.prototype.setLeaderboard=function(e){this.players=[],e.map((e=>{this.players.push(e)})),this.setUI()},Leaderboard.prototype.setUI=function(){if(this.players){this.scrollControllerEntity.fire("clearItems");let e=0;this.players.map((t=>{e++,this.scrollControllerEntity.fire("addNewEntry",t,e)}))}};var ScrollController=pc.createScript("scrollController");ScrollController.attributes.add("entryTemplateAssets",{type:"asset",assetType:"template",array:!0}),ScrollController.attributes.add("initialEntryCount",{type:"number",default:15}),ScrollController.attributes.add("leaderboardMenu",{type:"entity"});let items=[];ScrollController.prototype._onAddNewEntry=function(t,e){var r=Math.floor(pc.math.random(0,this.entryTemplateAssets.length)),n=this.entryTemplateAssets[r].resource.instantiate();n.reparent(this._content),n.fire("setPlayerData",t,e),this._content.fire("contentchanged"),this.items.push(n)},ScrollController.prototype._clearItems=function(){this.items&&(this.items.map((t=>t.destroy())),this.items=[])},ScrollController.prototype.initialize=function(){this.items=[],this._content=this.entity.scrollview.contentEntity,"string"==typeof this._content&&(this._content=this.app.getEntityFromIndex(this._content)),this.entity.on("addNewEntry",this._onAddNewEntry,this),this.entity.on("clearItems",this._clearItems,this);for(var t=0;t<this.initialEntryCount;++t)this._onAddNewEntry()};var ScrollVerticalAreaFitter=pc.createScript("scrollVerticalAreaFitter");ScrollVerticalAreaFitter.prototype._onContentChanged=function(){var t=this.entity.layoutgroup;if(t){for(var e=t.padding.y+t.padding.w,i=0,n=this.entity.children,r=0;r<n.length;++r){var a=n[r];a.layoutchild&&(i+=1,e+=a.element.height)}e+=Math.max(0,i-1)*t.spacing.y,this.entity.element.height=e}},ScrollVerticalAreaFitter.prototype.initialize=function(){this.entity.on("contentchanged",this._onContentChanged,this),this._onContentChanged()};var AddEntryButton=pc.createScript("addEntryButton");AddEntryButton.attributes.add("scrollControllerEntity",{type:"entity"});let clickCount=0;AddEntryButton.prototype.initialize=function(){this.entity.button.on("click",(function(t){clickCount++;this.scrollControllerEntity.fire("addNewEntry",{PlayerName:"Test Player",PlayerScore:"35"},clickCount)}),this)};var Entry=pc.createScript("entry");Entry.attributes.add("playerNoText",{type:"entity"}),Entry.attributes.add("playerNameText",{type:"entity"}),Entry.attributes.add("playerScoreText",{type:"entity"}),Entry.prototype.updatePlayerDataTexts=function(t,e){this.playerNameText.element.text=t.PlayerName,this.playerScoreText.element.text=t.PlayerScore,this.playerNoText.element.text=`#${e}`},Entry.prototype.initialize=function(){this.entity.on("setPlayerData",this.updatePlayerDataTexts,this)};var HtmlHandler=pc.createScript("htmlHandler");HtmlHandler.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),HtmlHandler.prototype.initialize=function(){console.log("initialize");const t=document.createElement("script");t.src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js",document.head.appendChild(t)},HtmlHandler.prototype.postInitialize=function(){console.log("postInitialize");const t=this.html.resource,e=(new DOMParser).parseFromString(t,"text/html").body.innerHTML,n=document.createElement("div");n.id="tonconnect-root",n.style="width: fit-content; margin: auto;",document.body.appendChild(n),document.body.insertAdjacentHTML("beforeend",e)};